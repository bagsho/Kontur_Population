---
title: "Kontur Population"
author: "Orhan Aktas"
date: '2022-11-18'
output:   
    html_document:
      df_print: !expr knitr::kable
      toc: yes
      number_sections: yes
      toc_depth: 2
---

```{r setup, include=FALSE,echo=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  class.source = "bg-warning text-warning"
)
```

#### Required Libraries {.unlisted .unnumbered}

```{r libraries, message=FALSE, warning=FALSE}
library(osrm)
library(sf)
library(tidyverse)
library(leaflet)
```

# Introduction

It would be nice to extract only the hexagons located within the boundaries of Istanbul.

My plan is to

1.  create a sqlite database and import the ".gpkg" file.
2.  find out the coordinates of an adequate rectangle that covers Istanbul.
3.  select the hexagons that stays within this rectangle and import that data into R.

# Import data

population data for turkey
```{r eval=FALSE}

nc = st_read("data/kontur_pop_tr.gpkg")

```

boundries for turkey
```{r}

boundries_tr = st_read("data/kontur_boundaries_TR_20220407.gpkg")


```

```{r}
boundries_tr |> filter(admin_level==4)|> st_geometry() |> plot()
boundries_tr |> filter(admin_level==4)|> select(population) |> plot()
```


boundry for istanbul
```{r}
boundry_ist<-boundries_tr |> filter(name_en=="Istanbul")

boundries_tr |> 
  filter(admin_level==10) |> 
  st_join(boundry_ist) |> 
  filter(name_en.y=="Istanbul") |> 
  select(population.x)|> 
  plot()

```

join with hexagon data

burayı henüz çözemedim.

crs uyumsuzluğu vardı. sanırım aşağıdaki gibi düzenleniyor.
https://stackoverflow.com/questions/49141192/st-intersects-errors-for-st-crsx-st-crsy-is-not-true

```{r eval=FALSE}

boundry_ist <- st_set_crs(boundry_ist, 3857)



```

aşağıdaki linkleri kullanıyorum


https://data.humdata.org/dataset/kontur-boundaries-turkey
http://rstudio-pubs-static.s3.amazonaws.com/417601_236011cd7d4c40f1a980436f41873f6d.html
https://r-spatial.github.io/sf/reference/geos_binary_pred.html
https://postgis.net/docs/T_Contains.html

https://github.com/gkaramanis/30DayMapChallenge/blob/main/2022/21-kontur-1000/21-kontur-1000.R



